// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
    provider = "prisma-client"
    output   = "../src/generated/prisma"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

model User {
    id           Int      @id @default(autoincrement()) @map("user_id")
    email        String   @unique @db.VarChar(100)
    password     String   @db.VarChar(255)
    name         String   @db.VarChar(100)
    restaurantId Int      @map("restaurant_id")
    isActive     Boolean  @default(true) @map("is_active")
    createdAt    DateTime @default(now()) @map("created_at")
    updatedAt    DateTime @updatedAt @map("updated_at")

    restaurant Restaurant @relation(fields: [restaurantId], references: [id], onDelete: Cascade)

    @@index([restaurantId])
    @@map("users")
}

model Restaurant {
    id        Int      @id @default(autoincrement()) @map("restaurant_id")
    name      String   @db.VarChar(255)
    address   String?  @db.Text
    phone     String?  @db.VarChar(20)
    email     String?  @db.VarChar(100)
    website   String?  @db.VarChar(255)
    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @updatedAt @map("updated_at")

    categories Category[]
    users      User[]

    @@map("restaurants")
}

model Category {
    id           Int      @id @default(autoincrement()) @map("category_id")
    restaurantId Int      @map("restaurant_id")
    name         String   @db.VarChar(100)
    description  String?  @db.Text
    displayOrder Int      @default(0) @map("display_order")
    isActive     Boolean  @default(true) @map("is_active")
    createdAt    DateTime @default(now()) @map("created_at")

    restaurant Restaurant @relation(fields: [restaurantId], references: [id], onDelete: Cascade)
    menuItems  MenuItem[]

    @@index([restaurantId, displayOrder], name: "idx_restaurant_order")
    @@map("categories")
}

model MenuItem {
    id              Int      @id @default(autoincrement()) @map("item_id")
    categoryId      Int      @map("category_id")
    name            String   @db.VarChar(255)
    description     String?  @db.Text
    price           Decimal  @db.Decimal(10, 2)
    imageUrl        String?  @map("image_url") @db.VarChar(500)
    isAvailable     Boolean  @default(true) @map("is_available")
    isVegetarian    Boolean  @default(false) @map("is_vegetarian")
    isVegan         Boolean  @default(false) @map("is_vegan")
    isGlutenFree    Boolean  @default(false) @map("is_gluten_free")
    isSpicy         Boolean  @default(false) @map("is_spicy")
    spiceLevel      Int      @default(0) @map("spice_level") @db.SmallInt
    calories        Int?
    preparationTime Int?     @map("preparation_time")
    servings        String?  @db.VarChar(50)
    displayOrder    Int      @default(0) @map("display_order")
    createdAt       DateTime @default(now()) @map("created_at")
    updatedAt       DateTime @updatedAt @map("updated_at")

    category  Category           @relation(fields: [categoryId], references: [id], onDelete: Cascade)
    allergens MenuItemAllergen[]
    modifiers Modifier[]

    @@index([categoryId, displayOrder], name: "idx_category_order")
    @@index([isAvailable], name: "idx_availability")
    @@index([name], name: "idx_menu_items_name")
    @@index([isVegetarian, isVegan, isGlutenFree], name: "idx_dietary_filters")
    @@map("menu_items")
}

model Allergen {
    id          Int      @id @default(autoincrement()) @map("allergen_id")
    name        String   @unique @db.VarChar(50)
    description String?  @db.Text
    icon        String?  @db.VarChar(100)
    createdAt   DateTime @default(now()) @map("created_at")

    menuItems MenuItemAllergen[]

    @@map("allergens")
}

model MenuItemAllergen {
    itemId     Int @map("item_id")
    allergenId Int @map("allergen_id")

    menuItem MenuItem @relation(fields: [itemId], references: [id], onDelete: Cascade)
    allergen Allergen @relation(fields: [allergenId], references: [id], onDelete: Cascade)

    @@id([itemId, allergenId])
    @@map("menu_item_allergens")
}

model Modifier {
    id              Int          @id @default(autoincrement()) @map("modifier_id")
    itemId          Int          @map("item_id")
    name            String       @db.VarChar(100)
    description     String?      @db.Text
    priceAdjustment Decimal      @default(0.00) @map("price_adjustment") @db.Decimal(10, 2)
    isAvailable     Boolean      @default(true) @map("is_available")
    modifierType    ModifierType @default(addon) @map("modifier_type")
    displayOrder    Int          @default(0) @map("display_order")
    createdAt       DateTime     @default(now()) @map("created_at")

    menuItem MenuItem @relation(fields: [itemId], references: [id], onDelete: Cascade)

    @@index([itemId, displayOrder], name: "idx_item_modifier")
    @@map("modifiers")
}

enum ModifierType {
    size
    addon
    substitution
    preparation

    @@map("modifier_type")
}
